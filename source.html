<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">


<body style="background-color: rgb(105,105,105)">
    <div class="container">
        <div class="row" style="height:200px; background-color: rgb(105,105,105)"></div>
        <div class="row" style="height:300px; background-color: rgb(47,79,79); border: 2px solid black">
            <div class="col-md-6">
                <p style="text-align:center"><em><b>General Assumptions</em></b></p>
                <form id="generalAssumptionsForm">
                  Discount Rate (%):<br>
                  <input type="number" name="discountRate" id="discountRate" value="2.5">
                  <br>
                </form>
            </div>
            <div class="col-md-6">
                <p style="text-align:center"><em><b>General Details</em></b></p>
                <form id="generalDetailsForm">
                  Date of Birth:<br>
                  <input type="date" name="dateBirth" id="dateBirth">
                  <br>
				  <!--Year of Birth:<br>
                  <input type="number" name="yearBirth" id="yearBirth">
                  <br>-->
				  Date of Accident:<br>
                  <input type="date" name="dateAccident" id="dateAccident" onchange="calcYear()">
                  <br>
                  <!--Year of Accident:<br>
                  <input type="number" name="yearAccident" id="yearAccident">
                  <br>-->
                  <div id="calcYearDiv"></div>
                  <!--Year of Calculation:<br>
                  <input type="number" name="yearCalc" id="yearCalc" onchange="postEarningsSetup()">-->
                </form>

            </div>       
        </div>
        <div class="row" style="height:400px; background-color: white" id="earningsSection">
            <div class="col-md-6" style="background-color: rgb(0,139,139); border: 1px solid black">
                <p style="text-align:center"><em><b>Pre-Accident</b></em></p>
                <form id="preAccidentForm" style="margin-left: 150px">
                  Pre-Accident Retirement Age:<br>
                  <input type="number" name="preAccidentRetirement" id="preAccidentRetirement">
                  <br>
                  Ceiling Age:<br>
                  <input type="number" name="preAccidentCeilingAge" id="preAccidentCeilingAge" value="45">
                  <br>
                  Earnings @ Accident:<br>
                  <input type="number" name="preEarningsAccident" id="preEarningsAccident">
                  <br>
                  Earnings @ Ceiling:<br>
                  <input type="number" name="preEarningsCeiling" id="preEarningsCeiling">
                </form>
            </div>
            <div class="col-md-6" style="background-color: rgb(0,139,139); border: 1px solid black">
                <div class="row" style="margin: auto">
					<p style="text-align:center"><em><b>Post-Accident</b></em></p>
				</div>
				<div class="row">
					<form id="postAccidentForm" style="margin-left: 150px">
					  Post-Accident Retirement Age:<br>
					  <input type="number" name="postAccidentRetirement" id="postAccidentRetirement">
					  <br>
					  Ceiling Age:<br>
					  <input type="number" name="postAccidentCeilingAge" id="postAccidentCeilingAge" value="45">
					  <br>
					  Actual Earnings Since Accident:<br>
					  <div id="postAccidentActuals"></div>
					  <br>
					  Earnings @ Ceiling:<br>
					  <input type="number" name="postEarningsCeiling" id="postEarningsCeiling">
					</form>
				</div>	
            </div>
        </div>
		<div class="row" style="margin: auto">
				<input type="button" class="btn btn-secondary" onclick="clearAll(2)" style="margin: auto" value="Clear Post-Accident Details">
				<input type="button" class="btn btn-secondary" onclick="clearAll(3)" style="margin: auto" value="Clear Pre-Accident Details">
		</div>
		
		<div class="row" style="height:50px; background-color: white"></div>
		
		
        <div class="row" style="height:50px; background-color: white">
            <button class="btn btn-secondary" onclick="calculate()" style="margin: auto">Calculate</button>
            <input type="button" class="btn btn-secondary" onclick="clearAll(1)" style="margin: auto" value="Clear All">
        </div>
        <div class="row" style="height:20px; background-color: white"></div>
        <div class="row" style="height:500px; background-color: white">
            <div class="col-md-12">
                <p style="text-align: center"><b>Result</b></p>
                <p style="text-align: center" id="preResult"><b></b></p>
                <p style="text-align: center" id="postResult"><b></b></p>
                <p style="text-align: center" id="totalResult"><b></b></p>
				<div class="row" style="height:50px"></div>
				<div class="row" style="height:250px">
					<div class="col-md-6" style="border: 1px solid black">
						<form id="contingencies">
						  Past Pre-Accident Contingency:<br>
						  <input type="number" name="pastPreCon" id="pastPreCon" value="5">
						  <br>
						  Past Post-Accident Contingency:<br>
						  <input type="number" name="pastPostCon" id="pastPostCon" value="5">
						  <br>
						  Future Pre-Accident Contingency:<br>
						  <input type="number" name="futurePreCon" id="futurePreCon" value="15">
						  <br>
						  Future Post-Accident Contingency:<br>
						  <input type="number" name="futurePostCon" id="futurePostCon" value="20">
						</form>
					</div>
					<div class="col-md-6" style="border: 1px solid black">
						<p style="text-align: center"><b>Contingency Result</b></p>
						<p style="text-align: center" id="preResultCon"><b></b></p>
						<p style="text-align: center" id="postResultCon"><b></b></p>
						<p style="text-align: center" id="totalResultCon"><b></b></p>
					</div>
				</div>
            </div>
        </div>
        <div class="row" style="height:200px; background-color: rgb(105,105,105)"></div>
    </div>

</body>

<script>
    var allForms = ["generalAssumptionsForm","generalDetailsForm","preAccidentForm","postAccidentForm"];
    var generalAssumptionsForm = ["generalAssumptionsForm"];
    var generalDetailsForm = ["generalDetailsForm"];
    
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/

    function calcYear(){
        var calcDateText = "";
        //calcYearText = "Year of Calculation:<br><input type=\"number\" name=\"yearCalc\" id=\"yearCalc\" onchange=\"postEarningsSetup()\">";
		calcDateText = "Date of Calculation:<br><input type=\"date\" name=\"dateCalculation\" id=\"dateCalculation\" onchange=\"postEarningsSetup()\">";
        document.getElementById("calcYearDiv").innerHTML = calcDateText;
    }

/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/

    function postEarningsSetup(){
        var postEarningsText = "";
        document.getElementById("earningsSection").style.height = "500px";
        document.getElementById("postAccidentActuals").innerHTML = "";
        //var yearAcc = parseFloat(document.getElementById("yearAccident").value);
        //var yearCalc = parseFloat(document.getElementById("yearCalc").value);
        var dateAcc = new Date(document.getElementById("dateAccident").value);
		var dateCalc = new Date(document.getElementById("dateCalculation").value);
		var yearAcc = dateAcc.getFullYear();
		var yearCalc = dateCalc.getFullYear();
		
		
        var pastPeriods = yearCalc - yearAcc + 1;

        for (i = 0; i < pastPeriods; i++){
            postEarningsText += (yearAcc + i) + " <input type=\"number\" name=\"pastEarnings" + i + "\" id=\"pastEarnings" + i + "\"><br>";
        }
        document.getElementById("postAccidentActuals").innerHTML = postEarningsText;
        document.getElementById("earningsSection").style.height = (400 + pastPeriods*20) + "px";
    }

/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/

    function calculate(){
        var accidentEarnings = parseFloat(document.getElementById("preEarningsAccident").value);
        var dateBirth = new Date(document.getElementById("dateBirth").value);
		var dateAcc = new Date(document.getElementById("dateAccident").value);
		var dateCalc = new Date(document.getElementById("dateCalculation").value);
		var yearBirth = dateBirth.getFullYear();
		var yearAcc = dateAcc.getFullYear();
		var yearCalc = dateCalc.getFullYear();
		var discountRate = 1 + parseFloat(document.getElementById("discountRate").value)/100;
		var futurePreCon = parseFloat(document.getElementById("futurePreCon").value)/100;
		var futurePostCon = parseFloat(document.getElementById("futurePostCon").value)/100;
		//var yearAcc = parseFloat(document.getElementById("yearAccident").value);
        //var yearCalc = parseFloat(document.getElementById("yearCalc").value);
        //var yearBirth = parseFloat(document.getElementById("yearBirth").value);
		
		
		/*---------------------------------------------------------------------------------------------------------------*/
		// PRE-ACCIDENT
		/*---------------------------------------------------------------------------------------------------------------*/
        var preAccidentCeiling = parseFloat(document.getElementById("preEarningsCeiling").value);
        var preAccidentCeilingAge = parseFloat(document.getElementById("preAccidentCeilingAge").value);
        var preAccidentRetirementAge = parseFloat(document.getElementById("preAccidentRetirement").value);
        var periods = Math.ceil(preAccidentRetirementAge - (yearAcc - yearBirth));
        var income = new Array();
        var age = new Array();
        var year = new Array();
        var tax = new Array();
        var discount = new Array();
        var survival = new Array();
        var result = 0;
        var annualIncrease = (preAccidentCeiling - accidentEarnings) / (preAccidentCeilingAge - (yearAcc - yearBirth) - 1);

        for (i = 0; i < periods; i++){
            age[i] = i + 1 + yearAcc - yearBirth;
            
            year[i] = yearAcc + i; 

            if(i == 0){
                income[i] = accidentEarnings;
            }
            else {
                if(age[i] > preAccidentCeilingAge){
                    income[i] = income[i-1];
                }
                else {
                    income[i] = accidentEarnings + annualIncrease * i;
                }
            }

            tax[i] = income[i] * 0.1;

            discount[i] = 1 / (Math.pow(discountRate,i+1));
            
            if(year[i] < yearCalc){
                survival[i] = 1;
            }            
            else {
                survival[i] = 0.99;    
            }

            result += (income[i] - tax[i]) * discount[i] * survival[i];
            //alert(age[i] + " " + year[i] + " " + income[i] + " " + tax[i] + " " + discount[i] + " " + survival[i]);
			//alert(year[i] + " and " + income[i]);
        }

        document.getElementById("preResult").innerHTML = "Pre-Accident = R" + result;
		document.getElementById("preResultCon").innerHTML = "Pre-Accident = R" + (1 - futurePreCon) * result;

		/*---------------------------------------------------------------------------------------------------------------*/
		// PRE-ACCIDENT
		/*---------------------------------------------------------------------------------------------------------------*/


		/*---------------------------------------------------------------------------------------------------------------*/
		// POST-ACCIDENT
		/*---------------------------------------------------------------------------------------------------------------*/
        var postAccidentCeiling = parseFloat(document.getElementById("postEarningsCeiling").value);
        var postAccidentCeilingAge = parseFloat(document.getElementById("postAccidentCeilingAge").value);
        var postAccidentRetirementAge = parseFloat(document.getElementById("postAccidentRetirement").value);
		var earningsAtCalc = parseFloat(document.getElementById("pastEarnings" + (yearCalc - yearAcc)).value);
        //var postPeriods = Math.ceil(postAccidentRetirementAge - (yearAcc - yearBirth));
        var postIncome = new Array();
        var postAge = new Array();
        var postYear = new Array();
        var postTax = new Array();
        var postDiscount = new Array();
        var postSurvival = new Array();
        var postResult = 0;
        //var postAnnualIncrease = (postAccidentCeiling - accidentEarnings) / (postAccidentCeilingAge - (yearAcc - yearBirth) - 1);
		var postAnnualIncrease = (postAccidentCeiling - earningsAtCalc) / (postAccidentCeilingAge - (yearCalc - yearBirth) - 1);
        var eliminationInidicator = 1;
		

        for (i = 0; i < periods; i++){
            postAge[i] = i + 1 + yearAcc - yearBirth;
            
            postYear[i] = yearAcc + i; 

            if(postAge[i] > postAccidentRetirementAge){
                eliminationInidicator = 0;
            }
            else {
                eliminationInidicator = 1;
            }

            if(i == 0){
                postIncome[i] = accidentEarnings;
            }
            else {
				if(postYear[i] <= yearCalc){
					postIncome[i] = parseFloat(document.getElementById("pastEarnings" + i).value) * eliminationInidicator;
				}
				else {
					if(postAge[i] > postAccidentCeilingAge){
						postIncome[i] = postIncome[i-1] * eliminationInidicator;
					}
					else {
						postIncome[i] = (earningsAtCalc + postAnnualIncrease * (i - (yearCalc - yearAcc))) * eliminationInidicator;
					}
				}
                
            }
			
			//alert(postYear[i] + " and " + postIncome[i]);
			
            postTax[i] = postIncome[i] * 0.1 * eliminationInidicator;

            postDiscount[i] = 1 / (Math.pow(discountRate,i+1));
            
            if(postYear[i] < yearCalc){
                postSurvival[i] = 1;
            }            
            else {
                postSurvival[i] = 0.99;    
            }

            postResult += (postIncome[i] - postTax[i]) * postDiscount[i] * postSurvival[i];
            
        }

        document.getElementById("postResult").innerHTML = "Post-Accident = R" + postResult;
		document.getElementById("postResultCon").innerHTML = "Post-Accident = R" + (1 - futurePostCon) * postResult;

		/*---------------------------------------------------------------------------------------------------------------*/
		// POST-ACCIDENT
		/*---------------------------------------------------------------------------------------------------------------*/

		document.getElementById("totalResult").innerHTML = "Total Loss = R" + (result - postResult);
		document.getElementById("totalResultCon").innerHTML = "Total Loss = R" + ((1 - futurePreCon) * result - (1 - futurePostCon) * postResult);

    }

/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------*/


    function clearAll(num){
	
		if (num == 1){
			document.getElementById("generalAssumptionsForm").reset();
			document.getElementById("generalDetailsForm").reset();
			document.getElementById("preAccidentForm").reset();
			document.getElementById("postAccidentForm").reset();
		}
		else if (num == 2) {
			document.getElementById("postAccidentForm").reset();
		}
		else if (num == 3) {
			document.getElementById("preAccidentForm").reset();
		}
       
    }


</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>


</html>
